# Esempi di Query per il Sistema di Gamification Uniswap V3

## Query 1: Top 10 utenti per punteggio (classifica)
```graphql
{
  users(
    first: 10
    orderBy: score
    orderDirection: desc
    where: { score_gt: "0" }
  ) {
    id
    totalVolumeUSD
    totalVolumeETH
    score
    txCount
    firstTransactionTimestamp
    lastTransactionTimestamp
  }
}
```

## Query 2: Top 20 utenti per volume USD
```graphql
{
  users(
    first: 20
    orderBy: totalVolumeUSD
    orderDirection: desc
    where: { totalVolumeUSD_gt: "1000" }
  ) {
    id
    totalVolumeUSD
    score
    txCount
  }
}
```

## Query 3: Dettagli specifici di un utente con i suoi swap
```graphql
{
  user(id: "0x742d35Cc6635C0532925a3b8d65C2A06c8bD75A8") {
    id
    totalVolumeUSD
    totalVolumeETH
    score
    txCount
    firstTransactionTimestamp
    lastTransactionTimestamp
    swaps(first: 5, orderBy: timestamp, orderDirection: desc) {
      id
      amountUSD
      timestamp
      pool {
        id
        token0 {
          symbol
        }
        token1 {
          symbol
        }
      }
    }
  }
}
```

## Query 4: Utenti con punteggio tra 1 e 10 (hanno fatto tra $1K e $10K di volume)
```graphql
{
  users(
    first: 50
    orderBy: score
    orderDirection: desc
    where: { 
      score_gte: "1"
      score_lte: "10"
    }
  ) {
    id
    totalVolumeUSD
    score
    txCount
  }
}
```

## Query 5: Dati giornalieri di un utente specifico
```graphql
{
  userDayDatas(
    first: 30
    orderBy: date
    orderDirection: desc
    where: { user: "0x742d35Cc6635C0532925a3b8d65C2A06c8bD75A8" }
  ) {
    id
    date
    dailyVolumeUSD
    dailyScore
    dailyTxCount
    user {
      id
    }
  }
}
```

## Query 6: Top utenti per volume giornaliero (classifica del giorno)
```graphql
{
  userDayDatas(
    first: 10
    orderBy: dailyVolumeUSD
    orderDirection: desc
    where: { 
      date_gte: 1671753600  # Replace with today's timestamp / 86400 * 86400
      dailyVolumeUSD_gt: "0"
    }
  ) {
    id
    user {
      id
    }
    dailyVolumeUSD
    dailyScore
    dailyTxCount
  }
}
```

## Query 7: Statistiche aggregate per la classifica generale
```graphql
{
  users(
    first: 100
    orderBy: score
    orderDirection: desc
  ) {
    id
    totalVolumeUSD
    score
    txCount
  }
}
```

## Query 8: Cerca utenti per range di punteggio
```graphql
{
  users(
    first: 50
    orderBy: score
    orderDirection: desc
    where: { 
      score_gte: "5"  # Utenti con almeno $5K di volume
    }
  ) {
    id
    totalVolumeUSD
    score
    txCount
  }
}
```

## Query 9: Recenti transazioni con info utente
```graphql
{
  swaps(
    first: 10
    orderBy: timestamp
    orderDirection: desc
  ) {
    id
    amountUSD
    timestamp
    user {
      id
      score
      totalVolumeUSD
    }
    pool {
      token0 {
        symbol
      }
      token1 {
        symbol
      }
    }
  }
}
```

## Come calcolare il rank di un utente specifico

Per ottenere il rank effettivo di un utente, puoi usare questa query e poi contare quanti utenti hanno un punteggio maggiore:

```graphql
{
  # Conta utenti con punteggio maggiore
  higherScoreUsers: users(
    where: { score_gt: "SCORE_DELL_UTENTE" }
  ) {
    id
  }
  
  # Ottieni l'utente specifico
  user(id: "INDIRIZZO_UTENTE") {
    id
    score
    totalVolumeUSD
  }
}
```

nuovi schema:

# User entity for tracking individual user volume and gamification score
type User @entity {
  # user address
  id: ID!
  # total volume in USD generated by this user
  totalVolumeUSD: BigDecimal!
  # total volume in ETH generated by this user
  totalVolumeETH: BigDecimal!
  # gamification score (1 point per $1000 USD volume)
  score: BigDecimal!
  # number of transactions made by this user
  txCount: BigInt!
  # timestamp of first transaction
  firstTransactionTimestamp: BigInt!
  # timestamp of last transaction
  lastTransactionTimestamp: BigInt!
  # swaps made by this user
  swaps: [Swap!]! @derivedFrom(field: "user")
  # daily data for this user
  userDayData: [UserDayData!]! @derivedFrom(field: "user")
}

# Daily aggregated data for users
type UserDayData @entity {
  # user address concatenated with date
  id: ID!
  # timestamp rounded to current day by dividing by 86400
  date: Int!
  # pointer to user
  user: User!
  # volume in USD for this day
  dailyVolumeUSD: BigDecimal!
  # volume in ETH for this day
  dailyVolumeETH: BigDecimal!
  # score gained this day
  dailyScore: BigDecimal!
  # number of transactions for this day
  dailyTxCount: BigInt!
}

